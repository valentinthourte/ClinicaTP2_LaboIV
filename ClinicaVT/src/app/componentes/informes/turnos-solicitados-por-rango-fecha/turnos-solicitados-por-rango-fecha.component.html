<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-4xl">
    
    <h4 class="text-primary text-center fw-semibold mb-4">{{ data.soloRealizados ? "Informe: Turnos realizados por Médico" : "Informe: Turnos por Médico" }}</h4>

    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4 max-h-80 overflow-y-auto">
      <div
        *ngFor="let esp of especialistas"
        class="text-center cursor-pointer p-2 border rounded hover:shadow"
        [class.border-primary]="especialistaSeleccionado?.id === esp.id"
        (click)="seleccionarEspecialista(esp)"
      >
        <img [src]="esp.urlImagen || 'assets/default-user.png'" class="rounded-full w-20 h-20 mx-auto object-cover mb-2 border" />
        <div class="fw-semibold">{{ esp.nombre }} {{ esp.apellido }}</div>
      </div>
    </div>

    <div *ngIf="especialistaSeleccionado" class="row align-items-end mb-4">
        <mat-form-field>
            <mat-label>Ingrese un rango de fechas</mat-label>
            <mat-date-range-input [rangePicker]="picker">
                <input matStartDate placeholder="Start date" [(ngModel)]="fechaDesde">
                <input matEndDate placeholder="End date" [(ngModel)]="fechaHasta">
            </mat-date-range-input>
            <mat-hint>DD/MM/YYYY – DD/MM/YYYY</mat-hint>
            <mat-datepicker-toggle [for]="picker"></mat-datepicker-toggle>
            <mat-date-range-picker #picker></mat-date-range-picker>
        </mat-form-field>

        <div *ngIf="especialistaSeleccionado" class="flex items-end justify-between mb-4">
        <button class="btn btn-outline-primary" (click)="buscarTurnos()">Buscar</button>
        <button class="btn btn-outline-success" (click)="exportarTurnos()" [disabled]="turnosFranja.length == 0">
            <i class="bi bi-file-earmark-excel"></i> Exportar
        </button>
        </div>
    </div>

    <div *ngIf="turnosFranja?.length" class="table-responsive max-h-72 overflow-y-auto">
      <table class="table table-bordered table-hover table-sm mb-0">
        <thead class="table-light">
          <tr>
            <th>Fecha</th>
            <th>Hora</th>
            <th>Especialidad</th>
            <th>Paciente</th>
            <th>Estado</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let turno of turnosFranja">
            <td>{{ turno.fecha | date: 'dd/MM/yyyy' }}</td>
            <td>{{ turno.hora }}</td>
            <td>{{ turno.especialidad?.especialidad }}</td>
            <td>{{ turno.paciente?.nombre }} {{ turno.paciente?.apellido }}</td>
            <td>
              <span class="badge" [appEstadoTurnoColor]="turno.estado">{{ turno.estado | titlecase }}</span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div *ngIf="turnosFranja?.length === 0 && especialistaSeleccionado && fechaDesde && fechaHasta" class="text-muted text-center mt-4">
      No se encontraron turnos en el período seleccionado.
    </div>

    <div class="text-end mt-4">
      <button class="btn btn-secondary" (click)="cerrar()">Cerrar</button>
    </div>
  </div>
</div>
